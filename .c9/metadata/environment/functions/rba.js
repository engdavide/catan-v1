{"filter":false,"title":"rba.js","tooltip":"/functions/rba.js","undoManager":{"mark":2,"position":2,"stack":[[{"start":{"row":0,"column":0},"end":{"row":58,"column":2},"action":"insert","lines":["module.exports = {","","    isLoggedIn: function(req,res,next){","        if(req.isAuthenticated()){","            return next();","        }","        req.session.returnTo = req.url;","        res.redirect('/login');","    },","    ","    isAdmin: (req, res, next) =>{","        if(req.isAuthenticated()){","            if(req.user.role == \"admin\"){","                return next();","            } else {","                res.send(\"UNAUTHORIZED\");","            }","        } else { ","            req.session.returnTo = req.url;","            res.redirect('/login');","      }","    },","    ","    isAdminCad: (req, res, next) =>{","      if(req.isAuthenticated()){","          if(req.user.role == \"admin\" || req.user.role == \"cad\"){","              return next();","            } else {","                res.send(\"UNAUTHORIZED\");","            }","        } else { ","            req.session.returnTo = req.url;","            res.redirect('/login');","      }","    },","","    getAllJobs: function (user) {","        if(user.role == \"admin\"){","            Jobs.find({}).exec(function(err, allItems){","                if(err){","                    console.log(err);","                } else {","                    console.log(allItems);","                    return allItems;","                }","            });","        } else {","            Jobs.find({'owner.companyName': user.companyName}).sort({timeIn: -1}).exec(function(err, filterItems){","                if(err) {","                    console.log(err);","                } else {","                    return filterItems;","                }","                ","            });","        }","    }","        ","};"],"id":1}],[{"start":{"row":35,"column":0},"end":{"row":56,"column":5},"action":"remove","lines":["","    getAllJobs: function (user) {","        if(user.role == \"admin\"){","            Jobs.find({}).exec(function(err, allItems){","                if(err){","                    console.log(err);","                } else {","                    console.log(allItems);","                    return allItems;","                }","            });","        } else {","            Jobs.find({'owner.companyName': user.companyName}).sort({timeIn: -1}).exec(function(err, filterItems){","                if(err) {","                    console.log(err);","                } else {","                    return filterItems;","                }","                ","            });","        }","    }"],"id":2}],[{"start":{"row":22,"column":0},"end":{"row":34,"column":6},"action":"remove","lines":["    ","    isAdminCad: (req, res, next) =>{","      if(req.isAuthenticated()){","          if(req.user.role == \"admin\" || req.user.role == \"cad\"){","              return next();","            } else {","                res.send(\"UNAUTHORIZED\");","            }","        } else { ","            req.session.returnTo = req.url;","            res.redirect('/login');","      }","    },"],"id":3}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":7,"column":31},"end":{"row":7,"column":31},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1586456916242,"hash":"a3a2d817ae865159dfe6d8ba7ac7a9a68a032f6d"}